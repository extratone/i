# Copyright 2005 Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  

#
# test running programs
#

load_lib mi-support.exp
set MIFLAGS "-i=mi1"

gdb_exit
if [mi_gdb_start] {
    continue
}

set testfile "nested-inlines"
set srcfile ${testfile}.c
set binfile ${objdir}/${subdir}/${testfile}

if [istarget "i\[3-6\]86-apple-darwin*"] {
    verbose "Skipping ppc inlining tests."
    return
}

set additional_flags "additional_flags=-O3"
if  { [gdb_compile "${srcdir}/${subdir}/${srcfile}" "${binfile}" executable [list debug $additional_flags]] != "" } {
     gdb_suppress_entire_file "Testcase compile failed, so all tests in this file will automatically fail."
}

if {$debug_default_format_is_dwarf == 0 } then {
        return;
}


mi_gdb_test "115-gdb-set auto-raise-load-levels 1" "115\\^done" "auto-raise-load-levels"

mi_gdb_test "118-gdb-set env SHELL /bin/tcsh" "118\\^done"  "set env SHELL"

mi_gdb_test "120-gdb-set env NSUnbufferedIO YES" "120\\^done" "set env NSUnbufferedIO"

mi_gdb_test "122-gdb-set env DYLD_NEW_LOCAL_SHARED_REGIONS YES" "122\\^done" "set env DYLD_NEW_LOCAL_SHARED_REGIONS"

mi_gdb_test "124-gdb-set env __CF_USER_TEXT_ENCODING 0x1268:0:0" "124\\^done" "set env __CF_USER_TEXT_ENCODING"

mi_gdb_test "125-gdb-set env DYLD_NO_FIX_PREBINDING YES" "125\\^done" "set env DYLD_NO_FIX_PREBINDING"

mi_gdb_test "126-gdb-set env SECURITYSESSIONID 4063c0" "126\\^done" "set env SECURITYSESSIONID"

mi_gdb_test "130-gdb-set inferior-auto-start-cfm off" "130\\^done" "set inferior-auto-start-cfm"

mi_delete_breakpoints
mi_gdb_reinitialize_dir $srcdir/$subdir
mi_gdb_load ${binfile}

mi_gdb_test "142-exec-arguments" "142\\^done" "exec-arguments"

mi_gdb_test "143sharedlibrary apply-load-rules all" ".*143\\^done" "sharedlibrary apply-load-rules"

mi_gdb_test "144-mi-verify-command file-fix-file-is-grooved" "144\\^done,name=\"file-fix-file-is-grooved\",defined=\"true\",implemented=\"true\"" "verify-command file-fix-file-is-grooved"

mi_gdb_test "145-file-fix-file-is-grooved" "145\\^done,supported=\"1\",details=\"Yes grooved!\"" "file-fix-file-is-grooved"

mi_gdb_test "146-break-insert -l -1 -f  -s $binfile \"$srcfile:12\"" "146\\^done,bkpt=\{number=\"1\",type=\"breakpoint\",disp=\"keep\",enabled=\"y\",addr=\"$hex\",func=\"main\",file=\".*$srcfile\",line=\"12\",shlib=\"$binfile\",times=\"0\"\}" "Set breakpoint at main"

mi_gdb_test "147-data-list-register-names" "147\\^done,register-names=\\\[\"r0\",\"r1\",\"r2\",\"r3\",\"r4\",\"r5\",\"r6\",\"r7\",\"r8\",\"r9\",\"r10\",\"r11\",\"r12\",\"r13\",\"r14\",\"r15\",\"r16\",\"r17\",\"r18\",\"r19\",\"r20\",\"r21\",\"r22\",\"r23\",\"r24\",\"r25\",\"r26\",\"r27\",\"r28\",\"r29\",\"r30\",\"r31\",\"f0\",\"f1\",\"f2\",\"f3\",\"f4\",\"f5\",\"f6\",\"f7\",\"f8\",\"f9\",\"f10\",\"f11\",\"f12\",\"f13\",\"f14\",\"f15\",\"f16\",\"f17\",\"f18\",\"f19\",\"f20\",\"f21\",\"f22\",\"f23\",\"f24\",\"f25\",\"f26\",\"f27\",\"f28\",\"f29\",\"f30\",\"f31\",\"v0\",\"v1\",\"v2\",\"v3\",\"v4\",\"v5\",\"v6\",\"v7\",\"v8\",\"v9\",\"v10\",\"v11\",\"v12\",\"v13\",\"v14\",\"v15\",\"v16\",\"v17\",\"v18\",\"v19\",\"v20\",\"v21\",\"v22\",\"v23\",\"v24\",\"v25\",\"v26\",\"v27\",\"v28\",\"v29\",\"v30\",\"v31\",\"pc\",\"ps\",\"cr\",\"lr\",\"ctr\",\"xer\",\"mq\",\"fpscr\",\"vscr\",\"vrsave\"\\\]" "data-list-register-names"


send_gdb "123-exec-run\n"
gdb_expect {
    -re  ".*running\[\r\n]$gdb_prompt (\r\n=shlibs-added.*)*" {
    pass "Exec run"
    }
}

# mi_gdb_test "123-exec-run" ".*running.*"  "Exec run"

gdb_expect { -re ".*stopped.*$gdb_prompt" { pass "Stopped at first breakpoint" }
  -re "$gdb_prompt $" {
      fail "failed to hit first breakpoint"
  }
  timeout {
      fail "(timeout) failed to hit first breakpoint" 
  }
}

# mi_gdb_test "148-exec-run" ".*148\\^running.*(gdb) .*=shlibs-added.*148\\\*stopped,reason=\"breakpoint-hit\",commands=\"no\",times=\"1\",bkptno=\"1\",thread-id=\"1\"" "Exec run"

mi_gdb_test "150-pid-info" "150\\^done,process-id=\"$decimal\"" "pid-info"

mi_gdb_test "151-thread-list-ids" "151\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "152-mi-verify-command stack-list-frames-lite" "152\\^done,name=\"stack-list-frames-lite\",defined=\"true\",implemented=\"true\"" "verify-command stack-list-frames-lite"

mi_gdb_test "0-thread-select 1" "0\\^done,new-thread-id=\"1\",frame=\{func=\"main\",args=\\\[\{name=\"argc\",value=\"1\"\},\{name=\"argv\",value=\"<value temporarily unavailable, due to optimizations>\"\}\\\],file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"12\",dir=\".*\"\},line=\"12\",file=\".*$srcfile\"" "thread-select 1"

mi_gdb_test "153-stack-list-frames-lite -limit 500" "153\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"1\"" "stack-list-frames-lite"

mi_gdb_test "154-stack-list-frames 0 0" "154\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"12\",dir=\".*\"\}\\\]" "stack-list-frames 0 0"


mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "156-stack-list-arguments 2 0 0" "156\\^done,stack-args=\\\[frame=\{level=\"0\",args=\\\[varobj=\{exp=\"argc\",value=\"1\",name=\"var1\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"argv\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var2\",numchild=\"1\",type=\"char \\\*\\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]\}\\\]" "stack-list-arguments 2 0 0"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "157-stack-list-locals 2 1" "157\\^done,locals=\\\[varobj=\{exp=\"x\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var3\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"result\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var4\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"false\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"n\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var5\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"false\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"i\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var6\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"false\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"buffer\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var7\",numchild=\"1\",type=\"char \\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\"false\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]" "stack-list-locals 2 1"

mi_gdb_test "158-mi-verify-command file-list-statics" "158\\^done,name=\"file-list-statics\",defined=\"true\",implemented=\"true\"" "verify-command file-list-statics"

mi_gdb_test "159-file-list-statics -file \"\\\*CURRENT FRAME\\\*\" -shlib \"\" --no-values -filter \"\\^_OBJC\" -constants 0" "159\\^done,statics=\\\[\\\]" "file-list-statics"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "160-var-update  \"var1\" \"var2\" \"var3\" \"var4\" \"var5\" \"var6\" \"var7\"" "160\\^done,changelist=\\\[\\\]" "var-update vars 1-7"

mi_gdb_test "161-exec-next" "161\\^running.*(gdb).*161\\\*stopped,reason=\"end-stepping-range\",thread-id=\"1\"" "exec-next"


mi_gdb_test "162-thread-list-ids" "162\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "163-stack-list-frames-lite -limit 500" "163\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"1\"" "stack-list-frames-lite"

mi_gdb_test "164-stack-list-frames 0 0" "164\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"14\",dir=\"/.*\"\}\\\]" "stack-list-frames 0 0"
 
mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "167-var-update  \"var1\" \"var2\" \"var3\" \"var4\" \"var5\" \"var6\" \"var7\"" "167\\^done,changelist=\\\[varobj=\{name=\"var1\",in_scope=\"true\",type_changed=\"false\"\},varobj=\{name=\"var4\",in_scope=\"true\",type_changed=\"false\"\},varobj=\{name=\"var5\",in_scope=\"true\",type_changed=\"false\"\},varobj=\{name=\"var6\",in_scope=\"true\",type_changed=\"false\"\}.*\\\]" "var-update vars 1-7"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "168-var-evaluate-expression \"var1\"" "168\\^done,value=\"<value temporarily unavailable, due to optimizations>\"" "var-evaluate-expression var1"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "169-var-evaluate-expression \"var4\"" "169\\^done,value=\"<value temporarily unavailable, due to optimizations>\"" "var-evaluate-expression var4"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "170-var-evaluate-expression \"var5\"" "170\\^done,value=\"<value temporarily unavailable, due to optimizations>\"" "var-evaluate-expression var5"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "171-var-evaluate-expression \"var6\"" "171\\^done,value=\"<value temporarily unavailable, due to optimizations>\"" "var-evaluate-expression var6"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "172-var-evaluate-expression \"var7\"" "172\\^done,value=\"<value temporarily unavailable, due to optimizations>\"" "var-evaluate-expression var7"

# mi_gdb_test "173-data-read-memory -- 0x00000000 x 1 1 100"  "173\\^done,addr=\"$hex\",nr-bytes=\"0\",total-bytes=\"100\",next-row=\"$hex\",prev-row=\"$hex\",next-page=\"$hex\",prev-page=\"$hex\",memory=\\\[\{addr=\"$hex\",data=\\\[\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\",\"N/A\"\\\]\}\\\]" "data-read-memory"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "174-interpreter-exec console-quoted \"step\"" ".*27.*y = bar.*174\\^running.*174\\^done,reason=\"end-stepping-range\".*" "console-quoted step 1"

mi_gdb_test "175-stack-list-frames-lite -limit 500" "175\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"2\"" "stack-list-frames-lite"

mi_gdb_test "176-stack-list-frames 0 0" "176\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"foo \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"27\",dir=\".*\"\}\\\]" "stack-list-frames 0 0"

mi_gdb_test "0-stack-select-frame 1" "0\\^done" "stack-select-frame 1"

mi_gdb_test "178-var-update  \"var1\" \"var2\" \"var3\" \"var4\" \"var5\" \"var6\" \"var7\"" "178\\^done,changelist=\\\[.*\\\]" "var-update vars 1-7"

mi_gdb_test "179-thread-list-ids" "179\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "182-stack-list-arguments 2 0 0" "182\\^done,stack-args=\\\[frame=\{level=\"0\",args=\\\[varobj=\{exp=\"argc\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var8\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"argv\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var9\",numchild=\"1\",type=\"char \\\*\\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]\}\\\]" "stack-list-arguments 2 0"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "183-stack-list-locals 2 1" "183\\^done,locals=\\\[varobj=\{exp=\"x\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var10\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"result\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var11\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"n\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var12\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"i\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var13\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"buffer\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var14\",numchild=\"1\",type=\"char \\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\".*\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]" "stack-list-locals 2 1"

mi_gdb_test "184-file-list-statics -file \"\\\*CURRENT FRAME\\\*\" -shlib \"\" --no-values -filter \"\\^_OBJC\" -constants 0" "184\\^done,statics=\\\[\\\]" "file-list-statics"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "186-var-update  \"var8\" \"var9\" \"var10\" \"var11\" \"var12\" \"var13\" \"var14\"" "186\\^done,changelist=\\\[\\\]" "var-update vars 8-14"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "188-var-update  \"var8\" \"var9\" \"var10\" \"var11\" \"var12\" \"var13\" \"var14\"" "188\\^done,changelist=\\\[\\\]" "var-update vars 8-14"


mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "191-interpreter-exec console-quoted \"step\"" ".*43.*z = baz.*191\\^running.*191\\^done,reason=\"end-stepping-range\".*" "console-quoted step 2"

mi_gdb_test "192-stack-list-frames-lite -limit 500" "192\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\},2=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"3\"" "stack-list-frames-lite"

mi_gdb_test "193-stack-list-frames 0 0" "193\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"bar \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"43\",dir=\".*\"\}\\\]" "stack-list-frames 0 0"

mi_gdb_test "0-stack-select-frame 1" "0\\^done" "stack-select-frame 1"

mi_gdb_test "195-var-update  \"var8\" \"var9\" \"var10\" \"var11\" \"var12\" \"var13\" \"var14\"" "195\\^done,changelist=\\\[.*\\\]" "var-update vars 8-14"

mi_gdb_test "196-thread-list-ids" "196\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "199-stack-list-arguments 2 0 0" ".*199\\^done,stack-args=\\\[frame=\{level=\"0\",args=\\\[varobj=\{exp=\"argc\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var15\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"argv\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var16\",numchild=\"1\",type=\"char \\\*\\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]\}\\\]" "stack-list-arguments 2 0 0"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "200-stack-list-locals 2 1" "200\\^done,locals=\\\[varobj=\{exp=\"x\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var17\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"result\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var18\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"n\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var19\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"i\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var20\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"buffer\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var21\",numchild=\"1\",type=\"char \\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\".*\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]" "stack-list-locals 2 1"

mi_gdb_test "201-file-list-statics -file \"\\\*CURRENT FRAME\\\*\" -shlib \"\" --no-values -filter \"\\^_OBJC\" -constants 0" "201\\^done,statics=\\\[\\\]" "file-list-statics"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "203-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "203\\^done,changelist=\\\[\\\]" "var-update vars 15-21"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "205-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "205\\^done,changelist=\\\[\\\]" "var-update vars 15-21"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "208-interpreter-exec console-quoted \"step\"" ".*62.*buffer = .*208\\^running.*208\\^done,reason=\"end-stepping-range\"" "console-quoted step 3"

mi_gdb_test "209-stack-list-frames-lite -limit 500" "209\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\},2=\{pc=\"$hex\",fp=\"$hex\"\},3=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"4\"" "stack-list-frames-lite"

mi_gdb_test "210-stack-list-frames 0 0" "210\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"baz \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"58\",dir=\".*\"\}\\\]" "stack-list-frames 0 0"

mi_gdb_test "0-stack-select-frame 1" "0\\^done" "stack-select-frame 1"

mi_gdb_test "212-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "212\\^done,changelist=\\\[.*\\\]" "var-update vars 15-21"

mi_gdb_test "213-thread-list-ids" "213\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "216-stack-list-arguments 2 0 0" "216\\^done,stack-args=\\\[frame=\{level=\"0\",args=\\\[varobj=\{exp=\"argc\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var22\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"argv\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var23\",numchild=\"1\",type=\"char \\\*\\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]\}\\\]" "stack-list-arguments 2 0 0"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "217-stack-list-locals 2 1" "217\\^done,locals=\\\[varobj=\{exp=\"x\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var24\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"result\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var25\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"n\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var26\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"i\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var27\",numchild=\"0\",type=\"int\",typecode=\"INT\",dynamic_type=\"\",in_scope=\"true\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\},varobj=\{exp=\"buffer\",value=\"<value temporarily unavailable, due to optimizations>\",name=\"var28\",numchild=\"1\",type=\"char \\\*\",typecode=\"PTR\",dynamic_type=\"\",in_scope=\".*\",block_start_addr=\"$hex\",block_end_addr=\"$hex\"\}\\\]" "stack-list-locals 2 1"

mi_gdb_test "218-file-list-statics -file \"\\\*CURRENT FRAME\\\*\" -shlib \"\" --no-values -filter \"\\^_OBJC\" -constants 0" "218\\^done,statics=\\\[\\\]"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "220-var-update  \"var22\" \"var23\" \"var24\" \"var25\" \"var26\" \"var27\" \"var28\"" "220\\^done,changelist=\\\[\\\]" "var-update vars 22-28"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "222-var-update  \"var22\" \"var23\" \"var24\" \"var25\" \"var26\" \"var27\" \"var28\"" "222\\^done,changelist=\\\[\\\]" "var-update vars 22-28"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "225-interpreter-exec console-quoted \"step\"" ".*225\\^running.*(gdb).*225\\\*stopped,reason=\"end-stepping-range\",thread-id=\"1\"" "console-quoted step 4"

mi_gdb_test "226-stack-list-frames-lite -limit 500" "226\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\},2=\{pc=\"$hex\",fp=\"$hex\"\},3=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"4\"" "stack-list-frames-lite"

mi_gdb_test "227-stack-list-frames 0 3" "227\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"baz \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"63\",dir=\".*\"\},frame=\{level=\"1\",addr=\"$hex\",fp=\"$hex\",func=\"bar \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"43\",dir=\".*\"\},frame=\{level=\"2\",addr=\"$hex\",fp=\"$hex\",func=\"foo \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"27\",dir=\".*\"\},frame=\{level=\"3\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"14\",dir=\".*\"\}\\\]" "stack-list-frames 0 3"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "229-var-update  \"var22\" \"var23\" \"var24\" \"var25\" \"var26\" \"var27\" \"var28\"" "229\\^done,changelist=\\\[.*\\\]" "var-update vars 22-28"

mi_gdb_test "230-thread-list-ids" "230\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "234-var-update  \"var22\" \"var23\" \"var24\" \"var25\" \"var26\" \"var27\" \"var28\"" "234\\^done,changelist=\\\[\\\]" 'var-update vars 22-28"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "236-interpreter-exec console-quoted \"finish\"" ".*236\\^running.*236\\\*stopped,reason=\"function-finished\",thread-id=\"1\"" "console-quoted finish 1"

mi_gdb_test "237-stack-list-frames-lite -limit 500" "237\\^done,gdb-result-var=\".*\",return-value=\"12345\",frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\},2=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"3\"" "stack-list-frames-lite"

mi_gdb_test "0-thread-select 1" "0\\^done,new-thread-id=\"1\",frame=\{func=\"bar \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"44\",dir=\".*\"\},line=\"44\",file=\".*$srcfile\"" "thread-select 1"

mi_gdb_test "238-stack-list-frames 0 2" "238\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"bar \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"44\",dir=\".*\"\},frame=\{level=\"1\",addr=\"$hex\",fp=\"$hex\",func=\"foo \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"27\",dir=\".*\"\},frame=\{level=\"2\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"14\",dir=\".*\"\}\\\]" "stack-list-frames 0 2"

mi_gdb_test "240-thread-list-ids" "240\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" 'thread-list-ids'

mi_gdb_test "241-var-delete \"var22\"" "241\\^done,ndeleted=\"1\"" "var-delete var22"

mi_gdb_test "242-var-delete \"var23\"" "242\\^done,ndeleted=\"1\"" "var-delete var23"

mi_gdb_test "243-var-delete \"var24\"" "243\\^done,ndeleted=\"1\"" "var-delete var24"

mi_gdb_test "244-var-delete \"var25\"" "244\\^done,ndeleted=\"1\"" "var-delete var25"

mi_gdb_test "245-var-delete \"var26\"" "245\\^done,ndeleted=\"1\"" "var-delete var26"

mi_gdb_test "246-var-delete \"var27\"" "246\\^done,ndeleted=\"1\"" "var-delete var27"

mi_gdb_test "247-var-delete \"var28\"" "247\\^done,ndeleted=\"1\"" "var-delete var28"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "249-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "249\\^done,changelist=\\\[.*\\\]" "var-update vars 15-21"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "251-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "251\\^done,changelist=\\\[\\\]" "var-update vars 15-21"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "254-interpreter-exec console-quoted \"step\"" ".*254\\^running.*(gdb).*254\\\*stopped,reason=\"end-stepping-range\",thread-id=\"1\"" "console-quoted step 5"

mi_gdb_test "255-stack-list-frames-lite -limit 500" "255\\^done,frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\},2=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"3\"" "stack-list-frames-lite"

mi_gdb_test "256-stack-list-frames 0 2" "256\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"bar \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"46\",dir=\".*\"\},frame=\{level=\"1\",addr=\"$hex\",fp=\"$hex\",func=\"foo \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"27\",dir=\".*\"\},frame=\{level=\"2\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"14\",dir=\".*\"\}\\\]" "stack-list-frames 0 2"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "258-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "258\\^done,changelist=\\\[\\\]" "var-update vars 15-21"

mi_gdb_test "259-thread-list-ids" "259\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "263-var-update  \"var15\" \"var16\" \"var17\" \"var18\" \"var19\" \"var20\" \"var21\"" "263\\^done,changelist=\\\[\\\]" "var-update vars 15-21"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "265-interpreter-exec console-quoted \"finish\"" ".*265\\^running.*265\\\*stopped,reason=\"function-finished\",thread-id=\"1\"" "console-quoted finish 2"

mi_gdb_test "266-stack-list-frames-lite -limit 500" "266\\^done,gdb-result-var=\".*\",return-value=\"49\",frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\},1=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"2\"" "stack-list-frames-lite"

mi_gdb_test "0-thread-select 1" "0\\^done,new-thread-id=\"1\",frame=\{func=\"foo \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"29\",dir=\".*\"\},line=\"29\",file=\".*$srcfile\"" "thread-select 1"

mi_gdb_test "267-stack-list-frames 0 1" "267\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"foo \\\[inlined\\\]\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"29\",dir=\".*\"\},frame=\{level=\"1\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"14\",dir=\".*\"\}\\\]" "stack-list-frames 0 1"

mi_gdb_test "269-thread-list-ids" "269\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "270-var-delete \"var15\"" "270\\^done,ndeleted=\"1\"" "var-delete var15"

mi_gdb_test "271-var-delete \"var16\"" "271\\^done,ndeleted=\"1\"" "var-delete var16"

mi_gdb_test "272-var-delete \"var17\"" "272\\^done,ndeleted=\"1\"" "var-delete var17"

mi_gdb_test "273-var-delete \"var18\"" "273\\^done,ndeleted=\"1\"" "var-delete var18"

mi_gdb_test "274-var-delete \"var19\"" "274\\^done,ndeleted=\"1\"" "var-delete var19"

mi_gdb_test "275-var-delete \"var20\"" "275\\^done,ndeleted=\"1\"" "var-delete var20"

mi_gdb_test "276-var-delete \"var21\"" "276\\^done,ndeleted=\"1\"" "var-delete var21"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "278-var-update  \"var8\" \"var9\" \"var10\" \"var11\" \"var12\" \"var13\" \"var14\"" "278\\^done,changelist=\\\[.*\\\]" "var-update vars8-14"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "279-var-evaluate-expression \"var10\"" "279\\^done,value=\"12345\"" "var-evaluate-expression var10"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "281-var-update  \"var8\" \"var9\" \"var10\" \"var11\" \"var12\" \"var13\" \"var14\"" "281\\^done,changelist=\\\[\\\]" "var-update vars 8-14"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "282-interpreter-exec console-quoted \"finish\"" ".*282\\^running.*282\\\*stopped,reason=\"function-finished\",thread-id=\"1\"" "console-quoted finish 1"

# mi_finish_to "main" "" "nested-inlines.c" "16" ".*" "39" "Finish out of inlined function (foo)"

mi_gdb_test "283-stack-list-frames-lite -limit 500" "283\\^done.*frames=\\\[0=\{pc=\"$hex\",fp=\"$hex\"\}\\\],valid=\"1\",count=\"1\"" "stack-list-frames-lite"

mi_gdb_test "284-stack-list-frames 0 0" "284\\^done,stack=\\\[frame=\{level=\"0\",addr=\"$hex\",fp=\"$hex\",func=\"main\",file=\".*$srcfile\",fullname=\".*$srcfile\",line=\"16\",dir=\".*\"\}\\\]" "stack-list-frames 0 0"

mi_gdb_test "286-thread-list-ids" "286\\^done,thread-ids=\{thread-id=\"1\"\},number-of-threads=\"1\"" "thread-list-ids"

mi_gdb_test "287-var-delete \"var8\"" "287\\^done,ndeleted=\"1\"" "var-delete var8"

mi_gdb_test "288-var-delete \"var9\"" "288\\^done,ndeleted=\"1\"" "var-delete var9"

mi_gdb_test "289-var-delete \"var10\"" "289\\^done,ndeleted=\"1\"" "var-delete var10"

mi_gdb_test "290-var-delete \"var11\"" "290\\^done,ndeleted=\"1\"" "var-delete var11"

mi_gdb_test "291-var-delete \"var12\"" "291\\^done,ndeleted=\"1\"" "var-delete var12"

mi_gdb_test "292-var-delete \"var13\"" "292\\^done,ndeleted=\"1\"" "var-delete var13"

mi_gdb_test "293-var-delete \"var14\"" "293\\^done,ndeleted=\"1\"" "var-delete var14"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "295-var-update  \"var1\" \"var2\" \"var3\" \"var4\" \"var5\" \"var6\" \"var7\"" "295\\^done,changelist=\\\[varobj=\{name=\"var3\",in_scope=\"true\",type_changed=\"false\"\}.*\\\]" "var-update vars 1-7"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "296-var-evaluate-expression \"var3\"" "296\\^done,value=\"12345\"" "var-evaluate-expression var3"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "298-var-update  \"var1\" \"var2\" \"var3\" \"var4\" \"var5\" \"var6\" \"var7\"" "298\\^done,changelist=\\\[\\\]" "var-update vars 1-7"

mi_gdb_test "0-stack-select-frame 0" "0\\^done" "stack-select-frame 0"

mi_gdb_test "299-interpreter-exec console-quoted \"c\"" ".*299\\^running.*(gdb).*299\\\*stopped,reason=\"exited-normally\"" "console-quoted continue 1" 


mi_gdb_exit
return 0

